mapWidgets={};mapWidgets.googleMapCallbacks=[];if(typeof django!=="undefined"&&django.jQuery){mapWidgets.jQuery=django.jQuery.noConflict()}else{mapWidgets.jQuery=jQuery.noConflict()}function googleMapWidgetsCallback(){window.addEventListener("load",event=>{for(let index=0;index<mapWidgets.googleMapCallbacks.length;index++){const widgetCallback=mapWidgets.googleMapCallbacks[index];new widgetCallback.class(widgetCallback.options)}})}(function($){let initializing=false,fnTest=/xyz/.test(function(){xyz})?/\bSuper\b/:/.*/;$.Class=function(){};$.Class.extend=function(prop){const Super=this.prototype;initializing=true;let prototype=new this;initializing=false;for(let name in prop){prototype[name]=typeof prop[name]=="function"&&typeof Super[name]=="function"&&fnTest.test(prop[name])?function(name,fn){return function(){let tmp=this.Super;this.Super=Super[name];const ret=fn.apply(this,arguments);this.Super=tmp;return ret}}(name,prop[name]):prop[name]}function Class(){if(!initializing&&this.init){this.init.apply(this,arguments)}}Class.prototype=prototype;Class.constructor=Class;Class.extend=arguments.callee;return Class};if(typeof Function.bind==="undefined"){Function.prototype.bind=function(obj){const method=this;tmp=function(){return method.apply(obj,arguments)};return tmp}}if(!Array.indexOf){Array.prototype.indexOf=function(obj){for(let i=0;i<this.length;i++){if(this[i]==obj){return i}}return-1}}})(mapWidgets.jQuery);(function($){DjangoMapWidgetBase=$.Class.extend({init:function(options){$.extend(this,options);this.coordinatesOverlayToggleBtn.on("click",this.toggleCoordinatesOverlay.bind(this));this.coordinatesOverlayDoneBtn.on("click",this.handleCoordinatesOverlayDoneBtnClick.bind(this));this.coordinatesOverlayInputs.on("change",this.handleCoordinatesInputsChange.bind(this));this.addMarkerBtn.on("click",this.handleAddMarkerBtnClick.bind(this));this.myLocationBtn.on("click",this.handleMyLocationBtnClick.bind(this));this.deleteBtn.on("click",this.resetMap.bind(this));if($(this.wrapElemSelector).closest(".module.collapse").length){$(document).on("show.fieldset",this.initializeMap.bind(this))}this.initializeMap.bind(this)();this.djangoInput.data("mwMapObj",this.map);this.djangoInput.data("mwClassObj",this)},initializeMap:function(){console.warn("Implement initializeMap method.")},updateMap:function(lat,lng){console.warn("Implement updateMap method.")},addMarkerToMap:function(lat,lng){console.warn("Implement this method for your map js library.")},fitBoundMarker:function(){console.warn("Implement this method for your map js library.")},removeMarker:function(){console.warn("Implement this method for your map js library.")},dragMarker:function(e){console.warn("Implement dragMarker method.")},handleMapClick:function(e){console.warn("Implement handleMapClick method.")},handleAddMarkerBtnClick:function(e){console.warn("Implement handleAddMarkerBtnClick method.")},isInt:function(value){return!isNaN(value)&&parseInt(Number(value))===value&&!isNaN(parseInt(value,10))},serializeMarkerToGeoJSON:function(){console.warn("Implement serializeMarkerToGeoJSON method.")},callPlaceTriggerHandler:function(lat,lng,place){},enableClearBtn:function(){this.deleteBtn.removeClass("mw-btn-default disabled").addClass("mw-btn-danger")},disableClearBtn:function(){this.deleteBtn.removeClass("mw-btn-danger").addClass("mw-btn-default disabled")},updateDjangoInput:function(place){const django_input_val=this.serializeMarkerToGeoJSON();const lng=django_input_val.coordinates[0];const lat=django_input_val.coordinates[1];this.djangoInput.val(JSON.stringify(django_input_val));this.updateUXCoordinatesInputs(lat,lng);this.callPlaceTriggerHandler(lat,lng,place);this.djangoGeoJSONValue={lng:lng,lat:lat};this.enableClearBtn()},resetMap:function(){if(!$.isEmptyObject(this.djangoGeoJSONValue)){this.hideOverlay();this.djangoInput.val("");this.coordinatesOverlayInputs.val("");$(this.addressAutoCompleteInput).val("");this.addMarkerBtn.removeClass("active");this.removeMarker();this.disableClearBtn();$(document).trigger(this.markerDeleteTriggerNameSpace,[this.djangoGeoJSONValue.lat,this.djangoGeoJSONValue.lng,this.wrapElemSelector,this.djangoInput]);this.djangoGeoJSONValue=null}},toggleCoordinatesOverlay:function(){this.coordinatesOverlayToggleBtn.toggleClass("active");$(".mw-coordinates-overlay",this.wrapElemSelector).toggleClass("hide")},updateUXCoordinatesInputs:function(lat,lng){$(".mw-overlay-latitude",this.wrapElemSelector).val(lat||"");$(".mw-overlay-longitude",this.wrapElemSelector).val(lng||"")},handleCoordinatesInputsChange:function(e){var lat=$(".mw-overlay-latitude",this.wrapElemSelector).val();var lng=$(".mw-overlay-longitude",this.wrapElemSelector).val();if(lat&&lng){this.addMarkerToMap(lat,lng);this.updateDjangoInput();this.fitBoundMarker()}},handleCoordinatesOverlayDoneBtnClick:function(){$(".mw-coordinates-overlay",this.wrapElemSelector).addClass("hide");this.coordinatesOverlayToggleBtn.removeClass("active")},handleMyLocationBtnClick:function(){this.showOverlay();if(navigator.geolocation){navigator.geolocation.getCurrentPosition(this.handleCurrentPosition.bind(this),this.handlecurrentPositionError.bind(this))}else{this.handlecurrentPositionError()}},handleCurrentPosition:function(location){this.addMarkerToMap(location.coords.latitude,location.coords.longitude);this.updateDjangoInput();this.hideOverlay();this.fitBoundMarker()},handlecurrentPositionError:function(){this.hideOverlay();alert("Your location could not be found.")},showOverlay:function(){this.loaderOverlayElem.removeClass("hide")},hideOverlay:function(){this.loaderOverlayElem.addClass("hide")}})})(mapWidgets.jQuery);(function($){DjangoMapboxPointFieldWidget=DjangoMapWidgetBase.extend({init:function(options){$.extend(this,options);this.coordinatesOverlayToggleBtn.on("click",this.toggleCoordinatesOverlay.bind(this));this.coordinatesOverlayDoneBtn.on("click",this.handleCoordinatesOverlayDoneBtnClick.bind(this));this.coordinatesOverlayInputs.on("change",this.handleCoordinatesInputsChange.bind(this));this.addMarkerBtn.on("click",this.handleAddMarkerBtnClick.bind(this));this.myLocationBtn.on("click",this.handleMyLocationBtnClick.bind(this));this.deleteBtn.on("click",this.resetMap.bind(this));if($(this.wrapElemSelector).closest(".module.collapse").length){$(document).on("show.fieldset",this.initializeMap.bind(this))}mapboxgl.accessToken=this.mapOptions.accessToken;this.mapboxSDK=new mapboxSdk({accessToken:this.mapOptions.accessToken});this.mapboxOptions=this.mapOptions.mapOptions||{};this.mapboxOptions.container=this.mapElement.id;this.geocoderOptions=this.mapOptions.geocoderOptions||{};this.geocoderOptions.mapboxgl=mapboxgl;this.geocoderOptions.accessToken=mapboxgl.accessToken;if(!this.geocoderOptions.placeholder){this.geocoderOptions.placeholder=this.geocoderInputPlaceholderText}this.geocoder=new MapboxGeocoder(this.geocoderOptions);if(this.mapboxOptions.center){this.mapboxOptions.center=[this.mapboxOptions.center[1],this.mapboxOptions.center[0]]}this.flyToEnabled=this.geocoderOptions.flyTo||false;this.geocoder.on("result",place=>this.handleAutoCompletePlaceChange(place.result));this.initializeMap.bind(this)()},initializeMap:function(){this.map=new mapboxgl.Map(this.mapboxOptions);document.getElementById(this.geocoderWrapID).appendChild(this.geocoder.onAdd(this.map));if(this.mapOptions.showZoomNavigation){this.map.addControl(new mapboxgl.NavigationControl)}this.addressAutoCompleteInput=$("input:first","#"+this.geocoderWrapID);$(this.mapElement).data("mwMapObj",this.map);$(this.mapElement).data("mwClassObj",this);if(!$.isEmptyObject(this.djangoGeoJSONValue)){this.addMarkerToMap(this.djangoGeoJSONValue.lat,this.djangoGeoJSONValue.lng);this.updateDjangoInput();this.fitBoundMarker()}},addMarkerToMap:function(lat,lng){this.removeMarker();this.marker=(new mapboxgl.Marker).setLngLat([parseFloat(lng),parseFloat(lat)]).setDraggable(true).addTo(this.map);this.marker.on("dragend",this.dragMarker.bind(this))},serializeMarkerToGeoJSON:function(){if(this.marker){const position=this.marker.getLngLat();return{type:"Point",coordinates:[position.lng,position.lat]}}return null},fitBoundMarker:function(){if(this.marker){if(this.flyToEnabled){this.map.flyTo({center:this.marker.getLngLat(),zoom:this.mapOptions.markerFitZoom||14})}else{this.map.jumpTo({center:this.marker.getLngLat(),zoom:this.mapOptions.markerFitZoom||14})}}},removeMarker:function(){if(this.marker){this.marker.remove()}this.marker=null},dragMarker:function(e){const position=this.marker.getLngLat();this.addMarkerToMap(position.lat,position.lng);this.updateDjangoInput()},handleAddMarkerBtnClick:function(e){$(this.mapElement).toggleClass("click");this.addMarkerBtn.toggleClass("active");if($(this.addMarkerBtn).hasClass("active")){this.map.on("click",this.handleMapClick.bind(this))}else{this.map.off("click",this.handleMapClick.bind(this))}},handleMapClick:function(e){this.map.off("click",this.handleMapClick.bind(this));$(this.mapElement).removeClass("click");this.addMarkerBtn.removeClass("active");this.addMarkerToMap(e.lngLat.lat,e.lngLat.lng);this.updateDjangoInput()},callPlaceTriggerHandler:function(lat,lng,place){if(place===undefined){this.mapboxSDK.geocoding.reverseGeocode({query:[parseFloat(lng),parseFloat(lat)]}).send().then(response=>{const address=response?.body?.features?.[0];this.geocoder.clear();const placeName=address?.place_name||"Unknown Place";this.addressAutoCompleteInput.val(placeName);$(document).trigger(this.placeChangedTriggerNameSpace,[address,lat,lng,this.wrapElemSelector,this.locationInput]);if($.isEmptyObject(this.locationFieldValue)){$(document).trigger(this.markerCreateTriggerNameSpace,[address,lat,lng,this.wrapElemSelector,this.locationInput])}else{$(document).trigger(this.markerChangeTriggerNameSpace,[address,lat,lng,this.wrapElemSelector,this.locationInput])}})}else{$(document).trigger(this.placeChangedTriggerNameSpace,[place,lat,lng,this.wrapElemSelector,this.locationInput])}},handleAutoCompletePlaceChange:function(place){if(!place.geometry){return}const lng=place.geometry.coordinates[0];const lat=place.geometry.coordinates[1];this.addMarkerToMap(lat,lng);this.updateDjangoInput(place);this.fitBoundMarker()},resetMap:function(){this.Super();this.geocoder.clear()}})})(mapWidgets.jQuery);